server {
    listen 80;

    # Allow uploads up to 25MB (20MB limit + buffer for testing)
    client_max_body_size 25M;

    index index.php;

    error_log /var/www/log/nginx/error.log;
    access_log /var/www/log/nginx/access.log;

    root /var/www/public;

    location / {
        fastcgi_pass php:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root/index.php;
        include fastcgi_params;
    }

    location ~ /(.*)\.(css|js|jpeg|png|jpg|pdf)  {
        try_files $uri =404;
        expires -1;
        
        # Serve PDF files with correct content type
        if ($request_filename ~* \.pdf$) {
            add_header Content-Type application/pdf;
            add_header Content-Disposition inline;
        }
    }
}

server {
    listen 8080;

    # Allow uploads up to 25MB (test server - 20MB limit + buffer for testing)
    client_max_body_size 25M;

    index index.php;

    error_log /var/www/log/nginx/error.log;
    access_log /var/www/log/nginx/access.log;

    root /var/www/public;

    location / {
        fastcgi_pass php_test:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root/index.php;
        include fastcgi_params;
    }

    location ~ /(.*)\.(css|js|jpeg|png|jpg|pdf)  {
        try_files $uri =404;
        expires -1;
        
        # Serve PDF files with correct content type
        if ($request_filename ~* \.pdf$) {
            add_header Content-Type application/pdf;
            add_header Content-Disposition inline;
        }
    }
}
<div class="study-container">
    <div class="study-header">
        <div class="study-header-content">
            <a href="<?= route('decks.show', ['id' => $deck->id]) ?>" class="btn-back">
                <i class="bi bi-arrow-left"></i> Voltar
            </a>
            <h3 class="study-deck-name"><?= htmlspecialchars($deck->name) ?></h3>
            <?php if (!empty($materials)): ?>
                <button type="button" class="btn btn-materials-study" data-bs-toggle="modal" data-bs-target="#materialsModal">
                    <i class="bi bi-file-earmark-pdf"></i> Materiais (<?= count($materials) ?>)
                </button>
            <?php endif; ?>
        </div>
        <div class="study-progress-bar">
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: <?= $progress ?>%"
                    aria-valuenow="<?= $progress ?>" aria-valuemin="0" aria-valuemax="100">
                </div>
                <span><?= $currentIndex + 1 ?> / <?= $totalCards ?></span>
            </div>
        </div>
    </div>

    <div class="study-card-container">
        <div class="card-flip-wrapper">
            <div class="playing-card <?= $showingAnswer ? 'flipped' : '' ?>">
                <!-- FRONT (Question) - Always rendered -->
                <div class="study-card-face study-card-front">
                    <div class="card-suit top-left suit-<?= $suit['color'] ?>">
                        <?= $number ?>
                    </div>
                    <div class="card-suit-symbol top-left suit-<?= $suit['color'] ?>">
                        <?= $suit['symbol'] ?>
                    </div>
                    
                    <div class="study-card-content">
                        <div class="card-text">
                            <?= nl2br(htmlspecialchars($card->front)) ?>
                        </div>
                    </div>
                    
                    <div class="card-suit bottom-right suit-<?= $suit['color'] ?>">
                        <?= $number ?>
                    </div>
                    <div class="card-suit-symbol bottom-right suit-<?= $suit['color'] ?>">
                        <?= $suit['symbol'] ?>
                    </div>
                </div>
                
                <!-- BACK (Answer) - Always rendered -->
                <div class="study-card-face study-card-back">
                    <div class="card-suit top-left suit-<?= $suit['color'] ?>">
                        <?= $number ?>
                    </div>
                    <div class="card-suit-symbol top-left suit-<?= $suit['color'] ?>">
                        <?= $suit['symbol'] ?>
                    </div>
                    
                    <div class="study-card-content">
                        <div class="card-text">
                            <?= nl2br(htmlspecialchars($card->back)) ?>
                        </div>
                    </div>
                    
                    <div class="card-suit bottom-right suit-<?= $suit['color'] ?>">
                        <?= $number ?>
                    </div>
                    <div class="card-suit-symbol bottom-right suit-<?= $suit['color'] ?>">
                        <?= $suit['symbol'] ?>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="study-actions">
        <?php if (!$showingAnswer): ?>
            <!-- Button to flip card -->
            <div class="flip-button-container">
                <a href="<?= route('study.flip') ?>" class="btn-flip">
                    <i class="bi bi-arrow-repeat"></i> Virar Card
                </a>
            </div>
        <?php else: ?>
            <!-- Response buttons -->
            <div class="response-buttons-container">
                <div class="response-buttons">
                    <form action="<?= route('study.answer') ?>" method="POST" style="display: inline;">
                        <input type="hidden" name="quality" value="0">
                        <button type="submit" class="btn-response btn-again">
                            <i class="bi bi-x-circle"></i>
                            <span class="response-label">Errei</span>
                            <span class="response-time"><?= $card->getNextIntervalText(0) ?></span>
                        </button>
                    </form>
                    
                    <form action="<?= route('study.answer') ?>" method="POST" style="display: inline;">
                        <input type="hidden" name="quality" value="1">
                        <button type="submit" class="btn-response btn-hard">
                            <i class="bi bi-emoji-frown"></i>
                            <span class="response-label">Difícil</span>
                            <span class="response-time"><?= $card->getNextIntervalText(1) ?></span>
                        </button>
                    </form>
                    
                    <form action="<?= route('study.answer') ?>" method="POST" style="display: inline;">
                        <input type="hidden" name="quality" value="2">
                        <button type="submit" class="btn-response btn-good">
                            <i class="bi bi-emoji-smile"></i>
                            <span class="response-label">Bom</span>
                            <span class="response-time"><?= $card->getNextIntervalText(2) ?></span>
                        </button>
                    </form>
                    
                    <form action="<?= route('study.answer') ?>" method="POST" style="display: inline;">
                        <input type="hidden" name="quality" value="3">
                        <button type="submit" class="btn-response btn-easy">
                            <i class="bi bi-emoji-laughing"></i>
                            <span class="response-label">Fácil</span>
                            <span class="response-time"><?= $card->getNextIntervalText(3) ?></span>
                        </button>
                    </form>
                </div>
            </div>
        <?php endif; ?>
    </div>
</div>

<!-- Modal de Materiais -->
<?php if (!empty($materials)): ?>
<div class="modal fade" id="materialsModal" tabindex="-1" aria-labelledby="materialsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content materials-modal-content">
            <div class="modal-header materials-modal-header">
                <h5 class="modal-title" id="materialsModalLabel">
                    <i class="bi bi-file-earmark-pdf"></i> Materiais de Apoio
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body materials-modal-body">
                <div class="materials-list">
                    <?php foreach ($materials as $material): ?>
                        <div class="material-item-modal">
                            <div class="material-info-modal">
                                <i class="bi bi-file-earmark-pdf-fill"></i>
                                <div>
                                    <h6><?= htmlspecialchars($material->title) ?></h6>
                                    <small><?= $material->getFormattedSize() ?></small>
                                </div>
                            </div>
                            <div class="material-actions-modal">
                                <a href="<?= $material->getFileUrl() ?>"
                                   target="_blank"
                                   class="btn btn-sm btn-secondary">
                                    <i class="bi bi-eye"></i> Ver
                                </a>
                                <a href="<?= $material->getFileUrl() ?>"
                                   download
                                   class="btn btn-sm btn-secondary">
                                    <i class="bi bi-download"></i> Baixar
                                </a>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>
    </div>
</div>
<?php endif; ?>

<div class="card-form-container">
    <div class="card-form-wrapper">
        <div class="card-form-header">
            <h2><i class="bi bi-pencil"></i> Editar Flashcard</h2>
            <p>Atualize o conteúdo do seu flashcard</p>
        </div>

        <form id="card_update" action="<?= route('cards.update', ['id' => $card->id]) ?>" method="post" class="card-form <?= $card->hasErrors() ? 'was-validated' : '' ?>" novalidate>
            <input type="hidden" name="_method" value="PUT">
            <input type="hidden" name="page" value="<?= $returnPage ?? 1 ?>">
            <input type="hidden" name="return_deck_id" value="<?= $returnDeckId ?? $card->deck_id ?>">
            <input type="hidden" name="sort" value="<?= htmlspecialchars($returnSort ?? 'created_desc') ?>">
            
            <div class="form-group-card">
                <label for="deck_id">
                    <i class="bi bi-collection"></i> Deck
                </label>
                <select
                    class="form-input-card"
                    id="deck_id"
                    name="card[deck_id]"
                    required>
                    <?php foreach ($decks as $deck): ?>
                        <option value="<?= $deck->id ?>" <?= $deck->id == $card->deck_id ? 'selected' : '' ?>>
                            <?= htmlspecialchars($deck->name) ?>
                        </option>
                    <?php endforeach; ?>
                </select>
            </div>

            <div class="form-group-card">
                <label for="front">
                    <i class="bi bi-card-heading"></i> Frente do Card
                </label>
                <textarea
                    class="form-input-card <?= ($card->hasErrors() && $card->errors('front')) ? 'is-invalid' : '' ?>"
                    id="front"
                    name="card[front]"
                    placeholder="Digite a pergunta ou conceito..."
                    maxlength="1000"
                    rows="4"
                    required
                    oninput="updateCharCount('front', 'frontCount', 1000)"><?= htmlspecialchars($card->front ?? '') ?></textarea>
                <?php if ($card->errors('front')): ?>
                    <div class="invalid-feedback" style="display: block !important;"><?= $card->errors('front') ?></div>
                <?php endif; ?>
            </div>

            <div class="form-group-card">
                <label for="back">
                    <i class="bi bi-card-text"></i> Verso do Card
                </label>
                <textarea
                    class="form-input-card <?= ($card->hasErrors() && $card->errors('back')) ? 'is-invalid' : '' ?>"
                    id="back"
                    name="card[back]"
                    placeholder="Digite a resposta ou explicação..."
                    maxlength="1000"
                    rows="4"
                    required
                    oninput="updateCharCount('back', 'backCount', 1000)"><?= htmlspecialchars($card->back ?? '') ?></textarea>
                <?php if ($card->errors('back')): ?>
                    <div class="invalid-feedback" style="display: block !important;"><?= $card->errors('back') ?></div>
                <?php endif; ?>
            </div>

            <div class="form-tip">
                <p>
                    <i class="bi bi-lightbulb"></i>
                    <strong>Dica:</strong> Você pode mover este card para outro deck se necessário!
                </p>
            </div>

            <div class="form-actions-card">
                <a href="<?= route('decks.edit', ['id' => $returnDeckId ?? $card->deck_id]) ?>?page=<?= $returnPage ?? 1 ?>&sort=<?= urlencode($returnSort ?? 'created_desc') ?>" class="btn-card btn-card-secondary">
                    <i class="bi bi-x-circle"></i> Cancelar
                </a>
                <button type="submit" class="btn-card btn-card-primary">
                    <i class="bi bi-check-circle"></i> Atualizar Card
                </button>
            </div>
        </form>
    </div>
</div>